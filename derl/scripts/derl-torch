""" Generic derl script to launch a learner. """
#!/usr/bin/env python3
from argparse import ArgumentParser
import tensorflow as tf
import derl
from derl.env.make_env_torch import make as make_env
from derl.learners.a2c_torch import A2CLearner
from derl.learners.ppo_torch import PPOLearner


def get_learners():
  """ Returns learner name to learner class mapping. """
  return {
    "a2c": A2CLearner,
    "ppo": PPOLearner
  }


def main():
  """ Script entry point. """
  parser = ArgumentParser()
  learners = get_learners()
  parser.add_argument("learner", choices=list(learners.keys()))
  args, unknown_args = parser.parse_known_args()
  learner_class = learners[args.learner]

  args = derl.get_args(
      atari_defaults=learner_class.get_parser_defaults("atari"),
      mujoco_defaults=learner_class.get_parser_defaults("mujoco"),
      args=unknown_args)

  kwargs = vars(args)
  env = make_env(args.env_id, kwargs.get("nenvs"), kwargs.get("seed"))
  learner = learner_class.make_with_args(env, args)
  learner.learn(args.logdir, args.log_period)


if __name__ == "__main__":
  main()
